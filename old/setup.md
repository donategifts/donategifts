# Setup

We are using [lerna.js](https://lerna.js.org/) for mono repository setup and [tsoa](https://tsoa-community.github.io/docs/) to generate our apis

Our custom packages are all prefixed with ```@donategifts```

Make sure to use npm 7 otherwise you will encounter errors.
You can install npm 7 with 

`sudo npm install -g npm@7` 

---

Inside the root directory

```bash
npm install
```

this will install everything needed in the new setup

---

```bash
npm run build
```

will compile all packages

---

if you made changes to a package you can build the package with

```bash
lerna run build --scope @donategifts/<package name>
```

---

if you want to use a module that's already installed in another package add the module name to the package json of the corresponding modul and run

```bash
lerna link
```

---
If you need to add an npm package to our packages you have to manually add the package + version to the package.json of our package and run npm install in the root of the project

---
additionally you can add that package with lerna so that it will symlink it during the adding process

```bash
lerna add <new package> --scope <package you want to add to>
```

---

if you want a fresh install, e.g after you pulled/merged v2 you can run 

```bash
npm run superclean && npm install && npm run build
```

```superclean``` will delete all node_modules and dist folders as well as deleting the tsconfig.tsbuildinfo files

---

if you want to work on a service you can use the same approach as mentioned above with adding packages

the build process is a bit different tho

if you want to build a service, ```cd``` into the service directory and ```npm runb build```

this will build only the service you are in right now and also generate a custom ```routes.ts``` file

**DO NOT CHANGE THIS FILE MANUALLY**

it is automatically generated by tsoa according to the controllers

make your changes in the controllers and generate it again with ```npm run build``` 

---

eslint and typescript settings are ready to go, ecma version support is set to version 2019

---

husky (commit hook) will lint your files once you commit your changes
